<!DOCTYPE html><html class="no-js" lang="en"><head><meta http-equiv="Content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="author" content="Christian Abbott"><title>How to globally customize exception stack traces in Python | Creatively... Do!</title><link rel="icon" href="/static/img/favicon.ico" sizes="16x16"><link rel="stylesheet" href="/static/css/main.48145ecaf044ab2f5633.min.css"><script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)
</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XK130NLWLE"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-XK130NLWLE')</script></head><body><div id="main-grid"><header id="site-header"><a id="header-home" href="/">Creatively Do!</a><input id="header-menu-btn" type="checkbox"><label id="header-menu-icon" for="header-menu-btn"><div class="header-nav-icon"></div><div class="header-nav-icon header-nav-icon-mid"></div><div class="header-nav-icon"></div></label><nav role="navigation"><a href="/">Home</a><a href="/about/">About</a><a href="/blog/">Blog</a><a href="/programs/">Apps</a></nav></header><main><div id="border"><div id="pushin"><h1 id="page-title">How to globally customize exception stack traces in Python</h1><nav class="breadcrumb"><a href="/">Home</a><a href="/blog/">Blog</a>How to globally customize exception stack traces in Python</nav><div><article id="blog-article"><p>The Python language has some useful flexibility when it comes to exceptions. Programmers
want as much relevant information as we can get when our code does something unexpected.
Python's default behavior for an unhandled exception is to print a stack trace, the error
type, and the error description. This is sent to <code>sys.stderr</code> (typically, the console),
like this:
</p><pre class="lang-rss"><code>>>> 1/0
Traceback (most recent call last):
  File "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stdin</span><span class="token punctuation">></span></span>", line 1, in <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>
ZeroDivisionError: integer division or modulo by zero</code></pre><p>That's useful, but perhaps in your code you'd prefer to see other specific data when
there's a crash. For example, it may be helpful to see the values of the current local
variables, or global variables. Python has not left you out in the cold here. In fact,
Python makes it incredibly easy to send whatever you like to <code>sys.stderr</code> using a hook.
During an unhandled exception, this is the function Python calls to print the error:
</p><pre class="lang-python"><code>sys<span class="token punctuation">.</span>excepthook<span class="token punctuation">(</span>exc_type<span class="token punctuation">,</span> value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span></code></pre><p>Which takes in these three values:</p><dl id="excepthook-definitions"><dt>exc_type</dt><dd>the <a href="https://docs.python.org/2/library/exceptions.html" target="_blank">exception class</a>,
such as ZeroDivisonError</dd><dt>value</dt><dd>the exception instance that wasn't handled</dd><dt>traceback</dt><dd>a trackeback object; the same as what is stored in <code>sys.last_traceback</code></dd><p>Note that these are the same three ordered values returned by <code>sys.exc_info()</code>
during an exception
</p></dl><p>You can create your own function which takes the same three arguments, make it do what you
like, and assign it to the hook:
</p><pre class="lang-python"><code><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">my_exchandler</span><span class="token punctuation">(</span>exc_type<span class="token punctuation">,</span> value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">>></span><span class="token operator">></span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Nothing to see here, folks. Everything's fine. Move along."</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys
<span class="token operator">>></span><span class="token operator">></span> sys<span class="token punctuation">.</span>excepthook <span class="token operator">=</span> my_exchandler
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span>
Nothing to see here<span class="token punctuation">,</span> folks<span class="token punctuation">.</span> Everything's fine<span class="token punctuation">.</span> Move along<span class="token punctuation">.</span></code></pre><p>Or, if you wanted to display all local and global variables as mentioned earlier
(which is slightly more useful than the modification above), do this:
</p><pre class="lang-python"><code><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys<span class="token punctuation">,</span> traceback
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">my_exchandler</span><span class="token punctuation">(</span>exc_type<span class="token punctuation">,</span> value<span class="token punctuation">,</span> tb<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">>></span><span class="token operator">></span>    traceback<span class="token punctuation">.</span>print_exception<span class="token punctuation">(</span>exc_type<span class="token punctuation">,</span> value<span class="token punctuation">,</span> tb<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>    <span class="token builtin">locals</span> <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span>    <span class="token keyword">for</span> active_vars <span class="token keyword">in</span> <span class="token punctuation">[</span>tb<span class="token punctuation">.</span>tb_frame<span class="token punctuation">.</span>f_locals<span class="token punctuation">,</span> tb<span class="token punctuation">.</span>tb_frame<span class="token punctuation">.</span>f_globals<span class="token punctuation">]</span><span class="token punctuation">:</span>
<span class="token operator">>></span><span class="token operator">></span>        header <span class="token operator">=</span> <span class="token string">'Locals:'</span> <span class="token keyword">if</span> <span class="token builtin">locals</span> <span class="token keyword">else</span> <span class="token string">'Globals:'</span>
<span class="token operator">>></span><span class="token operator">></span>        <span class="token keyword">print</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>        <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> active_vars<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">>></span><span class="token operator">></span>            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>k<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'__'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> k<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'__'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">>></span><span class="token operator">></span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'	</span><span class="token interpolation"><span class="token punctuation">{</span>k<span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span>v<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>        <span class="token builtin">locals</span> <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> sys<span class="token punctuation">.</span>excepthook <span class="token operator">=</span> my_exchandler
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> my_var <span class="token operator">=</span> <span class="token string">'suspicious value here?'</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
ZeroDivisionError<span class="token punctuation">:</span> integer division <span class="token keyword">or</span> modulo by zero
Locals<span class="token punctuation">:</span>
        my_var <span class="token operator">=</span> <span class="token string">'suspicious value here?'</span>
        traceback <span class="token operator">=</span> <span class="token operator">&lt;</span>module <span class="token string">'traceback'</span> <span class="token keyword">from</span> <span class="token string">'/usr/lib/python3.2/traceback.pyc'</span><span class="token operator">></span>
        my_exchandler <span class="token operator">=</span> <span class="token operator">&lt;</span>function my_exchandler at <span class="token number">0x89f895c</span><span class="token operator">></span>
        sys <span class="token operator">=</span> <span class="token operator">&lt;</span>module <span class="token string">'sys'</span> <span class="token punctuation">(</span>built<span class="token operator">-</span><span class="token keyword">in</span><span class="token punctuation">)</span><span class="token operator">></span>
Globals<span class="token punctuation">:</span>
        my_var <span class="token operator">=</span> <span class="token string">'suspicious value here?'</span>
        traceback <span class="token operator">=</span> <span class="token operator">&lt;</span>module <span class="token string">'traceback'</span> <span class="token keyword">from</span> <span class="token string">'/usr/lib/python2.7/traceback.pyc'</span><span class="token operator">></span>
        my_exchandler <span class="token operator">=</span> <span class="token operator">&lt;</span>function my_exchandler at <span class="token number">0x89f895c</span><span class="token operator">></span>
        sys <span class="token operator">=</span> <span class="token operator">&lt;</span>module <span class="token string">'sys'</span> <span class="token punctuation">(</span>built<span class="token operator">-</span><span class="token keyword">in</span><span class="token punctuation">)</span><span class="token operator">></span></code></pre><p>But then how do you get the default behavior back? And what if you code a replacement
function accidentally producing an exception itself? Not to worry, Python keeps a backup
copy of the default hook, and uses it when needed. It's here:
</p><pre class="lang-python"><code>sys<span class="token punctuation">.</span>__excepthook__</code></pre><p>You can use the backup copy to get back to the default behavior like this:</p><pre class="lang-python"><code>sys<span class="token punctuation">.</span>excepthook <span class="token operator">=</span> sys<span class="token punctuation">.</span>__excepthook__</code></pre></article><p class="blog-date">Posted 10/22/2013</p><div id="blog-categories"><h3><a href="/blog/category/">Blog Categories</a></h3><ul><li><a href="/blog/category/django/">django</a>
(2)</li><li><a href="/blog/category/environment/">environment</a>
(1)</li><li><a href="/blog/category/math/">math</a>
(2)</li><li><a href="/blog/category/python/">python</a>
(2)</li><li><a href="/blog/category/tango/">tango</a>
(5)</li><li><a href="/blog/category/web-development/">web development</a>
(1)</li></ul></div></div></div></div></main><footer id="site-footer"><nav role="navigation"><a href="/">Home</a><a href="/about/">About</a><a href="/blog/">Blog</a><a href="/programs/">Apps</a></nav><span id="copyright">&copy;2012-2022 Christian&nbsp;Abbott | <a href="/contact/">Contact</a></span></footer></div></body></html>